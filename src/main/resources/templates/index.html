<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <link rel="stylesheet" href="/css/board.css">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
          crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  <title>Trello</title>
  <style>
    .offcanvas {
      position: fixed;
      top: 0;
      bottom: 0;
      z-index: 1050;
      display: none;
      padding: 1rem;
      overflow-y: auto;
      background-color: rgba(236, 234, 238, 0.6);
    }

    .offcanvas.show {
      display: block;
    }
  </style>
</head>
<body>
<!-- Trello Clone -->
<div class="app">
  <!-- Main Header -->
  <header class="app-header">
    <div class="left">
      <div class="btn"><i class="fas fa-home"></i></div>
      <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"
              data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
        <i class="fab fa-trello"></i> Boards
      </button>
      <div class="btn search">
        Search
        <i class="fas fa-search"></i>
      </div>
    </div>

    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1"
         id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Trello</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <p>여기에 보드 리스트들 해놓고 누르면 화면이 아예 해당 보드로 바뀌도록</p>
      </div>
    </div>

    <div class="center">
      <div class="logo"><i class="fab fa-trello"></i> Trello</div>
    </div>
    <div class="right">
      <div class="btn"><i class="fas fa-plus"></i></div>
      <div class="btn"><i class="fas fa-info-circle"></i></div>
      <div class="btn"><i class="far fa-bell"></i></div>
      <div class="btn"><i class="fas fa-cog"></i></div>
      <a href="/api/my-page"><div class="btn"><i class="fas fa-user-tie"></i></div></a>
    </div>
  </header>

  <!-- App Board -->
  <main class="app-board">
    <header class="board-header">
      <div class="left">
        <div class="title" id="boardTitle"></div>
        <div class="btn"><i class="far fa-star"></i></div>
        <div class="btn">Personal</div>
        <div class="btn btn-text"><i class="fas fa-lock"></i> Private</div>
      </div>
      <div class="right">
        <div class="btn btn-text"><i class="fas fa-male"></i> Butler</div>
        <div class="btn btn-text"><i class="fas fa-ellipsis-h"></i> Menu</div>
      </div>
    </header>

    <!-- Board -->
    <section class="board-body">
      <div class="wrap-lists">
        <div class="board-col">
          <div class="list">
            <h4 class="list-title">List title</h4>
            <div class="card">Card 1</div>
            <a class="btn-list" href="#">+ Add another card</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- App Tint -->
  <div class="app-tint">
    <input type="color" id="app-color">
    <label for="app-color"><i class="fas fa-tint"></i></label>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.cookie.replace("jwt=", "Bearer ");
    getBoardListInOffcanvas().then(data => {
      if (data.length > 0) {
        const firstBoardId = data[0].id;
        fetchBoardDetails(firstBoardId);
      }
    });
  });

  const root = document.documentElement,
      colorIn = document.getElementById('app-color');

  // Color selection
  colorIn.addEventListener('input', function () {
    const color = this.value;
    root.style.setProperty('--app-col', color);
  })

  const offcanvas = new bootstrap.Offcanvas(document.getElementById('offcanvasWithBothOptions'));
  const offcanvasTrigger = document.querySelector('[data-bs-toggle="offcanvas"]');

  offcanvasTrigger.addEventListener('click', function () {
    if (!offcanvas.isShown) {
      offcanvas.show();
    } else {
      offcanvas.hide();
    }
  });

  async function getBoardListInOffcanvas() {
    try {
      const response = await fetch('/api/boards', {
        credentials: 'same-origin',
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        },
      });
      const data = await response.json();

      const offcanvasBody = document.querySelector('.offcanvas-body');
      offcanvasBody.innerHTML = ''; // 기존 내용을 비우고 다시 추가
      data.forEach(board => {
        const boardCol = document.createElement('div');
        boardCol.className = 'list';
        boardCol.innerHTML = `
        <button class="btn btn-primary" type="button" data-board-id="${board.id}">${board.title}</button>
      `;
        offcanvasBody.appendChild(boardCol);
      });

      const boardButtons = document.querySelectorAll('.offcanvas-body button');
      boardButtons.forEach(button => {
        button.addEventListener('click', () => {
          const boardId = button.dataset.boardId;
          fetchBoardDetails(boardId);
        });
      });

      return data; // 데이터 반환
    } catch (error) {
      console.error('Error fetching board list:', error);
      return []; // 에러 발생 시 빈 배열 반환
    }
  }

  function openModal(cardId) {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.tabIndex = cardId;
    let innerHtml = ``
    fetch(`/api/card/${cardId}`, {
      credentials: 'same-origin',
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
    })
     .then(response => response.json())
     .then(card => {
       innerHtml += `
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-card-id="${card.id}">${card.title}</h5>
           <button type="button" class="btn btn-primary edit-button-title" id="editTitle${card.id}" onclick="editTitleButton(${card.id})">Edit</button>
  <button type="button" class="btn btn-primary save-button-title d-none" id="saveTitle${card.id}" onclick="saveTitleButton(${card.id})">Save</button>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="item-container">
            <label for="cardColor">Card Color:</label>
            <div class="item-content">
              <select id="cardColor" disabled>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
                <option value="green">Green</option>
              </select>
              <button type="button" class="btn btn-primary edit-button" id="editColor">Edit</button>
              <button type="button" class="btn btn-primary save-button d-none" id="saveColor">Save</button>
            </div>
          </div>

          <div class="item-container">
            <label for="dueDate">Deadline</label>
            <div class="item-content">
              <input type="datetime-local" id="dueDate" disabled>
              <button type="button" class="btn btn-primary edit-button" id="editDueDate">Edit</button>
              <button type="button" class="btn btn-primary save-button d-none" id="saveDueDate">Save</button>
            </div>
          </div>

          <div class="item-container">
            <label for="description">Description:</label>
            <div class="item-content">
              <textarea id="description" disabled>${card.description}</textarea>
              <button type="button" class="btn btn-primary edit-button" id="editDescription">Edit</button>
              <button type="button" class="btn btn-primary save-button d-none" id="saveDescription">Save</button>
            </div>
          </div>

          <div class="item-container">
            <label for="comment">Comment:</label>
            <div class="item-content">
              <input type="text" id="comment" placeholder="Enter your comment">
              <button type="button" class="btn btn-primary add-comment-button" id="addComment">Add Comment</button>
            </div>
          </div>

            <div class="item-container">
            <label for="commentList">Comments:</label>
            <div class="item-content" id="commentList">
              <!-- 댓글 목록이 여기에 표시될 것입니다. -->

  `;
       // 모달 댓글 목록 추가

       if(card.commentList.length > 0) {
         for (let comment of card.commentList) {
           innerHtml += `
          <div class="commentInfo${comment.id}">
      <p>${comment.content}</p>
      <div class="commentButtons">
        <button type="button" class="btn btn-sm btn-primary edit-comment-button" data-comment-id="${comment.id}">Edit</button>
        <button type="button" class="btn btn-sm btn-danger delete-comment-button" data-comment-id="${comment.id}">Delete</button>
      </div>
    </div>
         `
         }
       }

       // 모달 푸터 추가
       innerHtml += `
            </div>
          </div>
        </div>
       <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger" id="delete-card-Button" onclick="deleteCard(${card.columnNo}, ${card.id})">Delete</button>
          <div class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton${card.id}" data-bs-toggle="dropdown" aria-expanded="false">
    Dropdown button
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton${card.id}">
    <li>
      <div class="dropdown-item">
        <p>변경 할 카드 포지션</p>
        <input type="text" id="positionInput${card.id}" placeholder="Enter text">
        <button class="btn btn-primary" onclick="changeCardPosition(${card.id},${card.columnNo})">이동하기</button>
      </div>
    </li>
    <li>
      <div class="dropdown-item">
        <p>카드 이동 할 컬럼 번호</p>
        <input type="text" id="changeColumnPositionInput${card.id}" placeholder="도착지 컬럼의 번호">
        <input type="text" id="changeCardPositionInput${card.id}" placeholder="도착지 카드의 포지션">
        <button class="btn btn-primary" onclick="changeCardColumnPosition(${card.id})">이동하기</button>
      </div>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
       `
        modal.innerHTML += innerHtml;
       // 모달을 body에 추가
       document.body.appendChild(modal);

       // 모달을 열기 위한 이벤트 리스너 추가
       modal.addEventListener('shown.bs.modal', () => {
         modal.classList.add('show');
       });

       modal.addEventListener('shown.bs.modal', () => {
         const colorSelect = modal.querySelector('#cardColor');
         if (card.color == null || card.color) {
           colorSelect.value = card.color;
         }

         // "deadline" 값이 datetime-local 입력란에 대입
         const deadlineInput = modal.querySelector('#dueDate');
         if (card.deadline) {
           deadlineInput.value = card.deadline;
         }
       });

       // 모달이 닫힐 때 제거
       modal.addEventListener('hidden.bs.modal', () => {
         document.body.removeChild(modal);
       });

       // 모달 열기
       const bootstrapModal = new bootstrap.Modal(modal);
       bootstrapModal.show();

       // Edit 버튼 클릭 시 처리
       const editButtons = modal.querySelectorAll('.edit-button');
       editButtons.forEach(editButton => {
         editButton.addEventListener('click', () => {
           const container = editButton.parentElement;
           const saveButton = container.querySelector('.save-button');
           saveButton.classList.remove('d-none');
           editButton.classList.add('d-none');
           const inputElement = container.querySelector('input, select, textarea'); // textarea 추가
           inputElement.removeAttribute('disabled');
           inputElement.removeAttribute('readonly'); // readonly 제거
         });
       });


       modal.addEventListener('click', event => {
         if (event.target.classList.contains('edit-comment-button')) {
           const commentId = event.target.getAttribute('data-comment-id');
           const commentElement = modal.querySelector(`.commentInfo${commentId}`);
           const commentTextElement = commentElement.querySelector('p');
           const editInput = document.createElement('input');
           editInput.type = 'text';
           editInput.value = commentTextElement.textContent;

           const saveButton = document.createElement('button');
           saveButton.type = 'button';
           saveButton.classList.add('btn', 'btn-sm', 'btn-primary', 'save-comment-button');
           saveButton.textContent = 'Save';
           saveButton.setAttribute('data-comment-id', commentId); // 여기서 추가

           commentTextElement.replaceWith(editInput);
           commentElement.querySelector('.commentButtons').appendChild(saveButton);

           event.target.style.display = 'none';
         } else if (event.target.classList.contains('delete-comment-button')) {
           const commentId = event.target.getAttribute('data-comment-id');
           const commentElement = modal.querySelector(`.commentInfo${commentId}`);

           fetch(`/api/comment/${commentId}`, {
             credentials: 'same-origin',
             method: 'DELETE',
             headers: {
               'Content-Type': 'application/json'
             },
           })
                   .then(response => {
                     if (response.statusCode == 200) {
                       alert('Color updated successfully');
                       // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                     }
                   })
                   .catch(error => {
                     console.error('An error occurred:', error);
                   });
           commentElement.remove();
         } else if (event.target.classList.contains('save-comment-button')) {
           const commentId = event.target.getAttribute('data-comment-id');
           const commentElement = event.target.closest(`.commentInfo${commentId}`);
           const editInput = commentElement.querySelector('input');
           const updatedComment = editInput.value.trim();
           if (updatedComment !== '') {
             fetch(`/api/comment/${commentId}`, {
               credentials: 'same-origin',
               method: 'PATCH',
               body: JSON.stringify({ content: updatedComment }), // 객체를 JSON 문자열로 변환
               headers: {
                 'Content-Type': 'application/json'
               },
             })
                     .then(response => {
                       if (response.statusCode == 201) {
                         alert('Color updated successfully');
                         // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                       }
                     })
                     .catch(error => {
                       console.error('An error occurred:', error);
                     });

             // 댓글 업데이트 후 UI 업데이트
             const commentTextElement = document.createElement('p');
             commentTextElement.textContent = updatedComment;

             editInput.replaceWith(commentTextElement);
             commentElement.querySelector('.edit-comment-button').style.display = 'inline-block';
             event.target.remove(); // 저장 버튼 제거
           }
         }
       });

       const addCommentButton = modal.querySelector('#addComment');
       const commentList = modal.querySelector('#commentList');
       addCommentButton.addEventListener('click', () => {
         const commentInput = modal.querySelector('#comment');
         const comment = commentInput.value.trim();
         if (comment !== '') {
           const commentElement = document.createElement('div');
           commentElement.className = 'comment';
           commentElement.textContent = comment;
           fetch(`/api/card/${cardId}/comment`, {
             credentials: 'same-origin',
             method: 'POST',
             body: JSON.stringify({ content: comment }), // 객체를 JSON 문자열로 변환
             headers: {
               'Content-Type': 'application/json'
             },
           })
                   .then(response => {
                     if (response.statusCode == 201) {
                       alert('Color updated successfully');
                       // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                     }
                   })
                   .catch(error => {
                     console.error('An error occurred:', error);
                   });
           commentList.appendChild(commentElement);
           commentInput.value = '';
         }
       });

       // Save 버튼 클릭 시 처리
       const saveButtons = modal.querySelectorAll('.save-button');
       saveButtons.forEach(saveButton => {
         saveButton.addEventListener('click', () => {
           const container = saveButton.parentElement;
           const editButton = container.querySelector('.edit-button');
           editButton.classList.remove('d-none');
           saveButton.classList.add('d-none');
           const inputElement = container.querySelector('input, select, textarea');
           inputElement.setAttribute('disabled', true);

           // 저장 로직 추가
           if (inputElement.id === 'cardColor') {
             const cardColor = inputElement.value;
             fetch(`/api/card/${cardId}/color`, {
               credentials: 'same-origin',
               method: 'PATCH',
               body: JSON.stringify({ color: cardColor }), // 객체를 JSON 문자열로 변환
               headers: {
                 'Content-Type': 'application/json'
               },
             })
                     .then(response => {
                       if (response.statusCode == 200) {
                         alert('Color updated successfully');
                         // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                       }
                     })
                     .catch(error => {
                       console.error('An error occurred:', error);
                     });
           } else if (inputElement.id === 'dueDate') {
             const deadline = inputElement.value.replace('T', ' ');
             fetch(`/api/card/${cardId}/deadline`, {
               credentials: 'same-origin',
               method: 'PATCH',
               body: JSON.stringify({ deadline: deadline }), // 객체를 JSON 문자열로 변환
               headers: {
                 'Content-Type': 'application/json'
               },
             })
                     .then(response => {
                       if (response.statusCode == 200) {
                         alert('Color updated successfully');
                         // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                       }
                     })
                     .catch(error => {
                       console.error('An error occurred:', error);
                     });
           } else if (inputElement.id === 'description') {
             const description = inputElement.value;
             fetch(`/api/card/${cardId}/description`, {
               credentials: 'same-origin',
               method: 'PATCH',
               body: JSON.stringify({ description: description }), // 객체를 JSON 문자열로 변환
               headers: {
                 'Content-Type': 'application/json'
               },
             })
                     .then(response => {
                       if (response.statusCode == 200) {
                         alert('Color updated successfully');
                         // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                       }
                     })
                     .catch(error => {
                       console.error('An error occurred:', error);
                     });
             console.log('Description:', description);
           }
         });
       });
     })
  }

  function moveCardWithinColumn(cardId) {
    // 카드를 컬럼 안에서 이동하는 로직 추가
    console.log(`Moving card ${cardId} within the column`);
  }

  function moveCardOutsideColumn(cardId) {
    // 카드를 컬럼 밖으로 이동하는 로직 추가
    console.log(`Moving card ${cardId} outside the column`);
  }

  function editTitleButton(cardId) {
    const modalTitle = document.querySelector(`[data-card-id="${cardId}"]`);
    const titleText = modalTitle.textContent;
    const titleInput = document.createElement('input');
    titleInput.type = 'text';
    titleInput.value = titleText;
    modalTitle.replaceWith(titleInput);

    const editButton = document.getElementById(`editTitle${cardId}`);
    const saveButton = document.getElementById(`saveTitle${cardId}`);
    editButton.classList.add('d-none');
    saveButton.classList.remove('d-none');
  }

  function saveTitleButton(cardId) {
    const modal = document.querySelector('.modal');
    const titleInput = modal.querySelector('input'); // 수정한 제목을 입력한 input 요소 선택
    const newTitle = titleInput.value;

    fetch(`/api/card/${cardId}/title`, {
      credentials: 'same-origin',
      method: 'PATCH',
      body: JSON.stringify({ title: newTitle }), // 객체를 JSON 문자열로 변환
      headers: {
        'Content-Type': 'application/json'
      },
    })
            .then(response => {
              if (response.statusCode == 200) {
                alert('Color updated successfully');
                // 여기서 다른 필요한 작업을 수행할 수 있습니다.
              }
            })
            .catch(error => {
              console.error('An error occurred:', error);
            });
    titleInput.classList.add('d-none'); // 입력 창 숨기기

    const editButton = document.getElementById(`editTitle${cardId}`);
    const saveButton = document.getElementById(`saveTitle${cardId}`);
    saveButton.classList.add('d-none');
    editButton.classList.remove('d-none');
    location.reload();
  }



  function fetchBoardDetails(boardId) {
    fetch(`/api/boards/${boardId}`, {
      credentials: 'same-origin',
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
    })
    .then(response => response.json())
    .then(data => {
      const boardTitle = document.getElementById('boardTitle');
      boardTitle.textContent = `${data.title}`;

      const boardBody = document.querySelector('.board-body');
      boardBody.innerHTML = ''; // 기존 내용을 비우고 다시 추가

      const wrapLists = document.createElement('div');
      wrapLists.className = 'wrap-lists';

      data.columns.forEach(column => {
        const boardCol = document.createElement('div');
        boardCol.className = 'board-col';

        const list = document.createElement('div');
        list.className = 'list';
        list.id = column.id;

        const listTitle = document.createElement('h4');
        listTitle.className = 'list-title';
        listTitle.textContent = column.title;
        list.appendChild(listTitle);

        column.cardList.forEach(card => {
          const cardDiv = document.createElement('div');
          cardDiv.className = 'card';
          cardDiv.textContent = card.title; // 카드의 제목을 표시
          cardDiv.id = card.id;
          cardDiv.addEventListener('click', () => {
            openModal(card.id); // 모달을 띄우는 함수 호출
          });
          list.appendChild(cardDiv);
        });

        const addCardLink = document.createElement('a');
        addCardLink.className = 'btn-list';
        addCardLink.href = '#';
        addCardLink.textContent = '+ Add another card';
        addCardLink.id = column.id;
        list.appendChild(addCardLink);
        addCardLink.addEventListener('click', () => addCard(column.id));

        boardCol.appendChild(list);
        wrapLists.appendChild(boardCol);
      });

      const addListCol = document.createElement('div');
      addListCol.className = 'board-col';
      const addListLink = document.createElement('a');
      addListLink.className = 'btn-list';
      addListLink.href = '#';
      addListLink.textContent = '+ Add another list';
      addListCol.appendChild(addListLink);
      wrapLists.appendChild(addListCol);

      const boardSection = document.createElement('section');
      boardSection.className = 'board-body';
      boardSection.appendChild(wrapLists);
      boardBody.appendChild(boardSection);
    })
    .catch(error => console.error('Error fetching board details:', error));
  }

  function saveCard(saveButton, columnId) {
    const cardElement = saveButton.closest('.card');
    const cardTitleInput = cardElement.querySelector('input');
    const cardTitle = cardTitleInput.value.trim(); // 입력된 텍스트 가져오기

    if (cardTitle !== '') {
      const cardText = document.createElement('p');
      cardText.textContent = cardTitle;

      fetch(`/api/column/${columnId}/card`, {
        credentials: 'same-origin',
        method: 'POST',
        body: JSON.stringify({ title: cardTitle }), // 객체를 JSON 문자열로 변환
        headers: {
          'Content-Type': 'application/json'
        },
      })
              .then(response => {
                if (response.statusCode == 201) {
                  alert('save card successfully');
                  // 여기서 다른 필요한 작업을 수행할 수 있습니다.
                }
              })
              .catch(error => {
                console.error('An error occurred:', error);
              });

      cardTitleInput.replaceWith(cardText); // 입력 필드 대신 텍스트 요소로 교체
      saveButton.remove(); // 버튼 삭제

      location.reload();
    }
  }

  function addCard(columnId) {
    const column = document.querySelector(`.list[id="${columnId}"]`);

    const newCard = document.createElement('div');
    newCard.className = 'card';

    const cardTitleInput = document.createElement('input');
    cardTitleInput.type = 'text';
    cardTitleInput.placeholder = 'Enter card title';

    const saveButton = document.createElement('button');
    saveButton.textContent = 'Save';
    saveButton.addEventListener('click', function() {
      saveCard(saveButton, columnId); // saveButton을 인자로 넘겨서 호출
    });

    newCard.appendChild(cardTitleInput);
    newCard.appendChild(saveButton);

    // "Add another card" 링크를 감싸는 div 요소 생성
    const addCardContainer = document.createElement('div');
    addCardContainer.className = 'add-card-container';

    // "Add another card" 링크를 div 요소 안으로 이동
    const addCardLink = column.querySelector('.btn-list');
    addCardContainer.appendChild(addCardLink);

    // 새로운 카드와 "Add another card" 링크를 순서대로 삽입
    column.appendChild(newCard);
    column.appendChild(addCardContainer);
  }

  function deleteCard(columnNo, cardNo) {
    fetch(`/api/column/${columnNo}/card/${cardNo}`, {
      credentials: 'same-origin',
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json'
      },
    })
            .then(response => {
              if (response.statusCode == 200) {
                alert('delete card successfully');
                // 여기서 다른 필요한 작업을 수행할 수 있습니다.
              }
              location.reload();
            })
            .catch(error => {
              console.error('An error occurred:', error);
            });
  }

  function changeCardPosition(cardNo, columnNo) {
    const positionInput = document.getElementById('positionInput'+cardNo); // 입력한 숫자를 가져옴
    const newPosition = parseInt(positionInput.value); // 입력한 숫자를 정수로 변환
    console.log(cardNo, columnNo, newPosition)
    fetch(`/api/column/${columnNo}/card/${cardNo}/change-position/${newPosition}`, {
      credentials: 'same-origin',
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
    })
            .then(response => {
              if (response.status == 200) {
                alert("카드 이동 완료");
              } else {
                alert("숫자로 값을 변경 || 포지션 제한 초과");
              }
              location.reload();
            })
            .catch(error => {
              alert(`An error occurred: ${error}`);
            });
  }

  function changeCardColumnPosition(cardNo) {
    const changeCardPositionInput = document.getElementById('changeCardPositionInput'+cardNo);
    const newCardPosition = parseInt(changeCardPositionInput.value);

    const changeColumnPositionInput = document.getElementById('changeColumnPositionInput'+cardNo);
    const newColumnPosition = parseInt(changeColumnPositionInput.value);

    fetch(`api/card/${cardNo}/change-column/${newColumnPosition}/change-position/${newCardPosition}`, {
      credentials: 'same-origin',
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
    })
            .then(response => {
              if (response.status == 200) {
                alert("카드 컬럼 이동 완료");
              } else {
                alert("숫자로 값을 변경 || 포지션 위치 제한 초과 || 컬럼 번호 확인");
              }
              location.reload();
            })
            .catch(error => {
              alert(`An error occurred: ${error}`);
            });
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</body>
</html>